{"id":"1302736","content":"package com.redhat.coolstore.service;\r\n\r\nimport com.redhat.coolstore.model.Order;\r\nimport com.redhat.coolstore.utils.Transformers;\r\nimport java.util.function.Consumer;\r\nimport javax.ejb.ActivationConfigProperty;\r\nimport javax.ejb.MessageDriven;\r\nimport javax.inject.Inject;\r\nimport javax.jms.JMSException;\r\nimport javax.jms.Message;\r\nimport javax.jms.MessageListener;\r\nimport javax.jms.TextMessage;\r\nimport weblogic.i18n.logging.NonCatalogLogger;\r\n\r\n@MessageDriven(\r\n   name = \"OrderServiceMDB\",\r\n   activationConfig = {@ActivationConfigProperty(\r\n   propertyName = \"destinationLookup\",\r\n   propertyValue = \"topic/orders\"\r\n), @ActivationConfigProperty(\r\n   propertyName = \"destinationType\",\r\n   propertyValue = \"javax.jms.Topic\"\r\n), @ActivationConfigProperty(\r\n   propertyName = \"acknowledgeMode\",\r\n   propertyValue = \"Auto-acknowledge\"\r\n)}\r\n)\r\npublic class OrderServiceMDB implements MessageListener {\r\n   @Inject\r\n   OrderService orderService;\r\n   @Inject\r\n   CatalogService catalogService;\r\n   private NonCatalogLogger log = new NonCatalogLogger(OrderServiceMDB.class.getName());\r\n\r\n   public void onMessage(Message rcvMessage) {\r\n      TextMessage msg = null;\r\n\r\n      try {\r\n         if (rcvMessage instanceof TextMessage) {\r\n            msg = (TextMessage)rcvMessage;\r\n            String orderStr = (String)msg.getBody(String.class);\r\n            this.log.info(\"Received order: \" + orderStr);\r\n            Order order = Transformers.jsonToOrder(orderStr);\r\n            this.log.info(\"Order object is \" + order);\r\n            this.orderService.save(order);\r\n            order.getItemList().forEach((orderItem) -> {\r\n               this.catalogService.updateInventoryItems(orderItem.getProductId(), orderItem.getQuantity());\r\n            });\r\n         }\r\n\r\n      } catch (JMSException var5) {\r\n         throw new RuntimeException(var5);\r\n      }\r\n   }\r\n}\r\n"}