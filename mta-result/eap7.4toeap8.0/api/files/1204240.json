{"id":"1204240","content":"package com.redhat.coolstore.utils;\r\n\r\nimport java.util.logging.Level;\r\nimport java.util.logging.Logger;\r\nimport javax.annotation.PostConstruct;\r\nimport javax.annotation.Resource;\r\nimport javax.ejb.Singleton;\r\nimport javax.ejb.Startup;\r\nimport javax.ejb.TransactionManagement;\r\nimport javax.ejb.TransactionManagementType;\r\nimport javax.inject.Inject;\r\nimport javax.sql.DataSource;\r\nimport org.flywaydb.core.Flyway;\r\nimport org.flywaydb.core.api.FlywayException;\r\n\r\n@Singleton\r\n@Startup\r\n@TransactionManagement(TransactionManagementType.BEAN)\r\npublic class DataBaseMigrationStartup {\r\n   @Inject\r\n   Logger logger;\r\n   @Resource(\r\n      mappedName = \"java:jboss/datasources/CoolstoreDS\"\r\n   )\r\n   DataSource dataSource;\r\n\r\n   @PostConstruct\r\n   private void startup() {\r\n      try {\r\n         this.logger.info(\"Initializing/migrating the database using FlyWay\");\r\n         Flyway flyway = new Flyway();\r\n         flyway.setDataSource(this.dataSource);\r\n         flyway.baseline();\r\n         flyway.migrate();\r\n      } catch (FlywayException var2) {\r\n         if (this.logger != null) {\r\n            this.logger.log(Level.SEVERE, \"FAILED TO INITIALIZE THE DATABASE: \" + var2.getMessage(), var2);\r\n         } else {\r\n            System.out.println(\"FAILED TO INITIALIZE THE DATABASE: \" + var2.getMessage() + \" and injection of logger doesn't work\");\r\n         }\r\n      }\r\n\r\n   }\r\n}\r\n"}