{"id":"1269952","content":"package com.redhat.coolstore.service;\r\n\r\nimport com.redhat.coolstore.model.Promotion;\r\nimport com.redhat.coolstore.model.ShoppingCart;\r\nimport com.redhat.coolstore.model.ShoppingCartItem;\r\nimport java.io.Serializable;\r\nimport java.util.HashMap;\r\nimport java.util.HashSet;\r\nimport java.util.Iterator;\r\nimport java.util.Map;\r\nimport java.util.Set;\r\nimport javax.enterprise.context.ApplicationScoped;\r\n\r\n@ApplicationScoped\r\npublic class PromoService implements Serializable {\r\n   private static final long serialVersionUID = 2088590587856645568L;\r\n   private String name = null;\r\n   private Set<Promotion> promotionSet = null;\r\n\r\n   public PromoService() {\r\n      this.promotionSet = new HashSet();\r\n      this.promotionSet.add(new Promotion(\"329299\", 0.25D));\r\n   }\r\n\r\n   public void applyCartItemPromotions(ShoppingCart shoppingCart) {\r\n      if (shoppingCart != null && shoppingCart.getShoppingCartItemList().size() > 0) {\r\n         Map<String, Promotion> promoMap = new HashMap();\r\n         Iterator var3 = this.getPromotions().iterator();\r\n\r\n         while(var3.hasNext()) {\r\n            Promotion promo = (Promotion)var3.next();\r\n            promoMap.put(promo.getItemId(), promo);\r\n         }\r\n\r\n         var3 = shoppingCart.getShoppingCartItemList().iterator();\r\n\r\n         while(var3.hasNext()) {\r\n            ShoppingCartItem sci = (ShoppingCartItem)var3.next();\r\n            String productId = sci.getProduct().getItemId();\r\n            Promotion promo = (Promotion)promoMap.get(productId);\r\n            if (promo != null) {\r\n               sci.setPromoSavings(sci.getProduct().getPrice() * promo.getPercentOff() * -1.0D);\r\n               sci.setPrice(sci.getProduct().getPrice() * (1.0D - promo.getPercentOff()));\r\n            }\r\n         }\r\n      }\r\n\r\n   }\r\n\r\n   public void applyShippingPromotions(ShoppingCart shoppingCart) {\r\n      if (shoppingCart != null && shoppingCart.getCartItemTotal() >= 75.0D) {\r\n         shoppingCart.setShippingPromoSavings(shoppingCart.getShippingTotal() * -1.0D);\r\n         shoppingCart.setShippingTotal(0.0D);\r\n      }\r\n\r\n   }\r\n\r\n   public Set<Promotion> getPromotions() {\r\n      if (this.promotionSet == null) {\r\n         this.promotionSet = new HashSet();\r\n      }\r\n\r\n      return new HashSet(this.promotionSet);\r\n   }\r\n\r\n   public void setPromotions(Set<Promotion> promotionSet) {\r\n      if (promotionSet != null) {\r\n         this.promotionSet = new HashSet(promotionSet);\r\n      } else {\r\n         this.promotionSet = new HashSet();\r\n      }\r\n\r\n   }\r\n\r\n   public String toString() {\r\n      return \"PromoService [name=\" + this.name + \", promotionSet=\" + this.promotionSet + \"]\";\r\n   }\r\n}\r\n"}